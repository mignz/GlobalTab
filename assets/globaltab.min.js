/*! GlobalTab by Miguel Nunes - https://github.com/mignz/GlobalTab */
class GlobalTab{constructor(){this.browser="Google Inc."==navigator.vendor?1:0,this.globalTabId=-1,this.dragLi=null,this.populateBookmarks(1==this.browser?"2":"unfiled_____")}launchMasonry(){return new Masonry(".grid",{itemSelector:".box",columnWidth:".sizer",percentPosition:!0})}populateBookmarks(e){const t=this;chrome.bookmarks.getChildren(e.toString(),function(n){void 0===n&&alert('Unable to find "Other Bookmarks" folder with ID:'+e+".");for(let e=0;e<n.length;e++)if("GlobalTab"==n[e].title){t.globalTabId=n[e].id;break}void 0!==t.globalTabId&&-1!==t.globalTabId?chrome.bookmarks.getChildren(t.globalTabId,function(e){const n=e.length;for(let o=0;o<n;o++)chrome.bookmarks.getChildren(e[o].id,function(r){const a=r.length,l=[];let d=0;for(let e=0;e<a;e++)l.push({title:r[e].title,url:r[e].url,id:r[e].id}),d=e;t.addBox(e[o].title,l,r[d].parentId),o==n-1&&d==a-1&&(t.launchMasonry(),t.addEvents())})}):t.welcome()})}addBox(e,t,n){const o=document.createElement("div");o.className="box";const r=document.createElement("div");r.className="inner";const a=document.createElement("h1");a.innerHTML=e,a.title="Open all links";const l=document.createElement("div");l.className="button button-add",l.innerHTML="ADD",l.pid=n,r.appendChild(l);const d=document.createElement("ul");for(let e=0;e<t.length;e++){let n=document.createElement("li");n.bid=t[e].id,n.draggable=!0;let o=document.createElement("a");""==t[e].title?(o.innerHTML="",n.className="spacer"):o.innerHTML=this.getIcon(t[e].url)+" "+t[e].title,o.href=t[e].url,o.bid=t[e].id;let r=document.createElement("span");r.className="button button-trash",r.innerHTML="TRASH",r.title="Remove";let a=document.createElement("span");a.className="button button-edit",a.innerHTML="EDIT",a.title="Edit",o.appendChild(r),o.appendChild(a),n.appendChild(o),d.appendChild(n)}r.appendChild(a),r.appendChild(d),o.appendChild(r),document.querySelector(".grid").appendChild(o)}getIcon(e){if(1==this.browser){const t=new URL(chrome.runtime.getURL("/_favicon/"));t.searchParams.set("pageUrl",e),t.searchParams.set("size","32"),e=t.toString()}else e="https://s2.googleusercontent.com/s2/favicons?domain_url="+e;return'<div class="img"><img src="'+e+'" width="16" height="16" alt="&#9737;"></div>'}addEvents(){this.addOpenAllEvent(),this.addAddEvent(),this.addEditEvent(),this.addRemoveEvent(),this.addDragEvents()}addOpenAllEvent(){const e=document.querySelectorAll("h1");for(let t=0;t<e.length;t++)e[t].addEventListener("click",function(e){for(let t=0;t<e.target.nextSibling.children.length;t++)chrome.tabs.create({url:e.target.nextSibling.children[t].children[0].href})},!1)}addAddEvent(){const e=document.querySelectorAll(".button-add");for(let t=0;t<e.length;t++)e[t].addEventListener("click",this.handleAddEvent,!1)}handleAddEvent(e){e.preventDefault();const t=prompt("Bookmark Title"),n=prompt("Address","https://");null!=t&&""!=t&&""!=n?chrome.bookmarks.create({parentId:e.target.pid,title:t,url:n},function(){location.reload()}):alert("Empty or invalid title or URL.")}addEditEvent(){const e=document.querySelectorAll(".button-edit");for(let t=0;t<e.length;t++)e[t].addEventListener("click",this.handleEditEvent,!1)}handleEditEvent(e){e.preventDefault(),chrome.bookmarks.get(e.target.parentNode.bid,function(t){const n=prompt("Bookmark Title",t[0].title),o=prompt("Address",t[0].url);""!=n&&""!=o?chrome.bookmarks.update(e.target.parentNode.bid,{title:n,url:o},function(){location.reload()}):alert("You didn't fill the title or URL.")})}addRemoveEvent(){const e=document.querySelectorAll(".button-trash");for(let t=0;t<e.length;t++)e[t].addEventListener("click",this.handleRemoveEvent,!1)}handleRemoveEvent(e){e.preventDefault(),confirm("Remove the bookmark?")&&chrome.bookmarks.remove(e.target.parentNode.bid,function(){location.reload()})}addDragEvents(){const e=this,t=document.querySelectorAll("li");for(let n=0;n<t.length;n++)t[n].addEventListener("dragstart",function(t){1!=e.browser&&t.dataTransfer.setData("Text",null),t.target.style.opacity=".3",e.dragLi=t.target},!1),t[n].addEventListener("dragenter",function(e){e.target.classList.add("over")},!1),t[n].addEventListener("dragover",function(e){e.preventDefault&&e.preventDefault(),e.dataTransfer.dropEffect="move"},!1),t[n].addEventListener("dragleave",function(e){e.target.classList.remove("over")},!1),t[n].addEventListener("drop",function(t){return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),e.dragLi!=t.target&&chrome.bookmarks.get(t.target.bid,function(t){chrome.bookmarks.get(e.dragLi.bid,function(n){let o=t[0].index;t[0].parentId==n[0].parentId&&t[0].index>n[0].index&&1!=e.browser&&(o+=1),chrome.bookmarks.move(n[0].id,{parentId:t[0].parentId,index:o},function(){location.reload()})})}),!1},!1),t[n].addEventListener("dragend",function(e){e.preventDefault(),e.stopPropagation(),e.target.style.opacity="1"},!1)}welcome(){chrome.bookmarks.create({parentId:1==this.browser?"2":"unfiled_____",title:"GlobalTab"},function(e){chrome.bookmarks.create({parentId:e.id,title:"Google"},function(e){chrome.bookmarks.create({parentId:e.id,title:"Google Search",url:"https://www.google.com/"},function(){chrome.bookmarks.create({parentId:e.id,title:"Google Play",url:"https://play.google.com/"},function(){chrome.bookmarks.create({parentId:e.id,title:"Google Maps",url:"https://www.google.com/maps"},function(){alert("Welcome to GlobalTab!\n\nWe have created an example bookmark panel for you.\nYou can create more bookmark panels using your browser's native bookmark manager.\nAdd and organise folders inside GlobalTab."),location.reload()})})})})})}}document.addEventListener("DOMContentLoaded",function(){new GlobalTab});